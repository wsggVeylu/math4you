import"./hoisted.24428bad.js";function C(e,r,l,c,n){const a=document.querySelector(`#${e}`),y=document.querySelectorAll(`.${r}`),f=Array.from(y),B=f.length;let d=0;const v=document.querySelector(`#${l}`),g=document.querySelector(`#${c}`),w=Math.ceil(B/n);v&&(v.addEventListener("click",()=>{d>0&&(d--,b())}),a&&a.appendChild(v)),g&&(g.addEventListener("click",()=>{d<w-1&&(d++,b())}),a&&a.appendChild(g));function b(){const j=d*n,Y=Math.min((d+1)*n,B);for(let h=0;h<B;h++)f[h].style.display=h>=j&&h<Y?"block":"none";v&&(v.style.display=d===0?"none":"block"),g&&(g.style.display=d===w-1?"none":"block")}b()}const q=/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/;function S(e){return!!e.match(q)}const u=document.getElementById("accountUsername"),o=document.getElementById("accountUsernameInput"),E=document.getElementById("accountUsernameEditIcon"),m=document.getElementById("accountEmail"),s=document.getElementById("accountEmailInput"),k=document.getElementById("accountEmailEditIcon"),i=document.getElementById("accountPasswordInput"),I=document.getElementById("accountPasswordEditIcon"),A=document.getElementById("favoritedBooksContainer"),x=document.getElementById("favoritedAppsContainer");let t;u&&fetch("/api/account",{method:"GET"}).then(async e=>{let r=await e.json();if(e.status===200){if(t=r.accountDetails,u&&(u.textContent=t.username,o&&(o.value=t.username)),m&&(m.textContent=t.email,s&&(s.value=t.email)),A){const l=document.getElementById("favoritedBookItemTemplate");if(l)if(t.favoriteBooks.length>0){const c=await fetch("/data/books.json").then(n=>n.json());for(let n=0;n<t.favoriteBooks.length;n++){const a=l.cloneNode(!0),y=a.querySelector("img"),f=a.querySelector("p");a.removeAttribute("id"),a.removeAttribute("style"),a.href="/book/"+t.favoriteBooks[n],y.src=c[t.favoriteBooks[n]].image,f.textContent=c[t.favoriteBooks[n]].display_name,A.appendChild(a)}l.remove(),C("favoritedBooksContainer","favoritedBookItem","prevButtonBooks","nextButtonBooks",8)}else l.remove()}if(x){const l=document.getElementById("favoritedAppItemTemplate");if(l)if(t.favoriteApps.length>0){const c=await fetch("/data/apps.json").then(n=>n.json());for(let n=0;n<t.favoriteApps.length;n++){const a=l.cloneNode(!0),y=a.querySelector("img"),f=a.querySelector("p");a.removeAttribute("id"),a.removeAttribute("style"),a.href="/app/"+t.favoriteApps[n],y.src=c[t.favoriteApps[n]].image,f.textContent=c[t.favoriteApps[n]].display_name,x.appendChild(a)}l.remove(),C("favoritedAppsContainer","favoritedAppItem","prevButtonApps","nextButtonApps",8)}else l.remove()}}else e.status===500?(alert(r.message+" You will have to sign in again."),window.location.reload()):alert(r.message)});E&&u&&o&&(o.addEventListener("blur",()=>{if(o.value.length<3){alert("Your username must be at least 3 characters long!");return}o.style.display="none",u.style.display="block",u.textContent=o.value,E.style.display="inline"}),o.addEventListener("keypress",e=>{e.key==="Enter"&&o.blur()}),E.addEventListener("click",()=>{u.style.display="none",o.style.display="block",o.value=u.textContent?.trim(),o.focus(),E.style.display="none"}));k&&m&&s&&(s.addEventListener("blur",()=>{S(s.value)?(s.style.display="none",m.style.display="block",m.textContent=s.value,k.style.display="inline"):alert("You have entered an invalid email address!")}),s.addEventListener("keypress",e=>{e.key==="Enter"&&s.blur()}),k.addEventListener("click",()=>{m.style.display="none",s.style.display="block",s.value=m.textContent?.trim(),s.focus(),k.style.display="none"}));I&&i&&(i.addEventListener("blur",()=>{if(i.value.length>0&&i.value.length<8){alert("Your password must be at least 8 characters long!");return}i.style.display="none",I.style.display="inline"}),i.addEventListener("keypress",e=>{e.key==="Enter"&&i.blur()}),I.addEventListener("click",()=>{i.style.display="block",i.focus(),I.style.display="none"}));const L=document.getElementById("logoutButton");L&&L.addEventListener("click",()=>{fetch("/api/logout",{method:"POST"}).then(async e=>{let r=await e.json();e.status===200||e.status===401?(alert(r.message),window.location.reload()):alert(r.message)})});const p=document.getElementById("saveUserInfo");p&&p.addEventListener("click",()=>{if(o&&s&&i){let e={};if(o.value.length<3){alert("Your username must be at least 3 characters long!");return}if(!S(s.value)){alert("You have entered an invalid email address!");return}if(i.value.length>0&&i.value.length<8){alert("Your password must be at least 8 characters long!");return}if(u&&m&&o.value===t.username&&s.value===t.email&&i.value===""){alert("You have not changed any of your account information!");return}if(o.value!==t.username&&(e={username:o.value},t.username=o.value),s.value!==t.email&&(e={...e,email:s.value},t.email=s.value),i.value!==""&&(e={...e,password:i.value}),Object.keys(e).length===0){alert("You have not changed any of your account information! Or something has gone wrong.");return}fetch("/api/account",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then(async r=>{p.textContent="Saving...",p.disabled=!0;let l=await r.json();if(r.status===200){const c=document.getElementById("accountPasswordInput");c&&(c.value=""),setTimeout(()=>{p.textContent="Save Account Info",p.disabled=!1},6e3),alert(l.message)}else r.status===401?(alert(l.message),window.location.reload()):alert(l.message)})}});
